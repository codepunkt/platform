<mat-toolbar color="primary" #mainToolbar>
  <div class="toolbar-title">Senstate 0.1.4</div>

  <div class="space"></div>

  <div class="right-side">
    <button mat-button *ngIf="!isMobile"
            [mdePopoverTriggerFor]="themePopover"
            [mdePopoverTargetAt]="{_elementRef: qrImg}"
            mdePopoverTriggerOn="click">
      Mobile Mode <img src="assets/qrcode.png" #qrImg>
    </button>

    <button mat-icon-button
            [mdePopoverTriggerFor]="settingsPopover"
            [mdePopoverTargetAt]="mainToolbar"
            mdePopoverTriggerOn="click">
      <mat-icon svgIcon="settings_applications"
                style="width: 32px; height: 32px">

      </mat-icon>
    </button>
  </div>

  <!--
  <button mat-icon-button [mdePopoverTriggerFor]="notificationsPopover" [mdePopoverTargetAt]="mainToolbar" mdePopoverTriggerOn="click">
    <mat-icon>notifications</mat-icon>
  </button>
  -->

  <mde-popover #settingsPopover="mdePopover"
               [mdePopoverOverlapTrigger]="false"
               [mdePopoverCloseOnClick]="false"
               [mdePopoverOffsetX]="-25"
               [mdePopoverOffsetY]="2"
               [mdePopoverArrowOffsetX]="15"
               mdePopoverArrowColor="#FFFFFF">
    <div class="popover mat-elevation-z2">
      <label>Debounce Events</label>
      <div class="data-delay">
        <mat-icon svgIcon="watch_later"></mat-icon>

        <mat-slider [min]="0" [max]="1000"
                    [value]="200" #slider
                    [step]="50"
                    [tickInterval]="100"
                    [thumbLabel]="true"
                    (change)="changeDebounce($event)">

        </mat-slider>

        <span>
        {{ delayLabel(slider.value) }}
          </span>
      </div>
    </div>
  </mde-popover>
</mat-toolbar>

<div class="content">
  <div *ngIf="mappedApps$ | async as apps">
    <div *ngFor="let app of apps; trackBy: trackByAppFunc">
      <h2 class="mat-h2">{{app.name}}</h2>

      <mat-tab-group>
        <mat-tab>
          <ng-template mat-tab-label>
            <span [matBadge]="getObjectLength(app.watchers)"
                  matBadgeOverlap="false">Watchers</span>
          </ng-template>

          <ng-container *ngIf="getValues(app.watchers) as watchers">

            <h2 class="mat-h3" *ngIf="watchers.length === 0">
              No watchers yet :)
            </h2>


            <div class="cards">
              <ng-container *ngFor="let tag of watchers; trackBy: trackByWatcherFunc"
                            [ngSwitch]="tag.type">
                <div class="card">
                  <span class="label mat-caption">{{ tag.tag }}</span>
                  <senstate-string-watcher
                      [watchId]="tag.watchId"
                    *ngSwitchCase="0"
                  ></senstate-string-watcher>

                  <senstate-number-watcher
                    *ngSwitchCase="1"

                    [watchId]="tag.watchId"
                  ></senstate-number-watcher>

                  <senstate-number-watcher
                    *ngSwitchCase="3"
                  ></senstate-number-watcher>

                  <senstate-json-watcher
                    *ngSwitchCase="2"
                    [watchId]="tag.watchId"
                  >

                  </senstate-json-watcher>

                  <mat-card *ngSwitchDefault>
                    <mat-card-title>{{tag.tag}}</mat-card-title>
                    <mat-card-subtitle>{{tag.watchId}}</mat-card-subtitle>
                  </mat-card>
                </div>
              </ng-container>
            </div>
          </ng-container>
        </mat-tab>
        <mat-tab label="Log">
          <senstate-log-viewer [logArray]="getAppLogs$(app.appId) | async"></senstate-log-viewer>
        </mat-tab>
        <mat-tab *ngIf="getAppErrors$(app.appId) | async as errors">
          <ng-template mat-tab-label>
            <span [matBadge]="''+errors.length"
                  matBadgeOverlap="false">Errors</span>
          </ng-template>

          <div *ngFor="let l of errors">
            <senstate-json-viewer [data]="l.data"></senstate-json-viewer>
          </div>
        </mat-tab>
      </mat-tab-group>

    </div>
  </div>


  <mde-popover #themePopover="mdePopover"
               [mdePopoverOverlapTrigger]="false"
               [mdePopoverCloseOnClick]="false"
               [mdePopoverOffsetX]="0"
               [mdePopoverOffsetY]="2"
               [mdePopoverArrowOffsetX]="15"
               mdePopoverArrowColor="#FFFFFF">
    <div class="popover mat-elevation-z2">
      <div>1. Open your Phone</div>
      <br>
      <div>2. Scan this qr-code</div>
      <br>
      <ng-container *ngIf="networkInterface$ | async as interface">
        <qr-code
          [value]="interface" [size]="150">

        </qr-code>
        <br/>
        <div>or open <br/><code>{{interface}}</code></div>

      </ng-container>
    </div>
  </mde-popover>


</div>


<mat-toolbar color="primary" class="footer">
  <span class="data" title="App # Watcher-Count">
    <mat-icon svgIcon="important_devices"></mat-icon> &nbsp;
    {{ (mappedApps$ | async)?.length }} # {{ watcherCount$ | async }}</span>
  <span class="span"> </span>
  <span class="data">
    Socket: {{socketStatus$ | async }}
</span>

</mat-toolbar>
